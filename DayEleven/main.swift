//
//  main.swift
//  DayEleven
//
//  Created by Mia Koring on 01.11.24.
//

import Foundation

let input = """
...........#..........#...........................#....................#......#........................................................#....
...#........................#..............................#...................................................................#............
......................................#...................................................................#...........#.....................
...............................................#...............#.......................#....................................................
..........................................#...........#.............................................#.......................................
..........#.................................................................#................................#..............................
................................#.................................................................................#......#..................
..................................................................#.........................................................................
............................................................#..................#.......................................................#....
................................................#............................................#...............................#..............
.....#..............#..............................................................#................................#.......................
.........................................#...............................................#.................................................#
..............................#................................#.......#....................................................................
........................................................................................................................#...................
...#......#.......#.................#...................#......................................#.......#.......#........................#...
...........................................#...............................#....................................................#...........
...................................................................................#........................................................
.............#............#........................................#.......................................#......#.........................
................................#............................#...............................#..............................................
........................................#.............#.........................#......#......................................#.............
........................................................................................................#.....#.............................
......#............#...............#..............#.........................................................................................
...........#..................#............#.....................#..................................................#.......................
.......................................................................#..................#................#.......................#........
..#...................................#.....................................#.....#..................#......................................
............................................................................................................................................
............................#........................#.........................................#............................................
.......#......................................................................................................................#.............
......................#.......................................................#.............................................................
.#...........................................................#.....#..................................................#.................#...
..................................#....................................................#....................................................
.................................................................................#..............................#...........................
........#.................................#..........#......................................#............#..................................
..................#........................................................#................................................................
.............................#................#......................#...............................#..........................#......#....
..............#......................#..................................................................................#...................
...............................................................................................................#............................
..#.....................#.......................................#...................................................#.......................
..................................#....................#..........................................#.........................................
....................#.....................#......#.........................................................................#.......#........
............................................................#..........#...................................................................#
....#........................#................................................#...........#...............#......#..........................
............................................................................................................................................
..........#............................#....................................................................................................
...............#...............................#......#.............................................#.................................#.....
......................#..........#.........................#.......#..................................................#.....................
...............................................................................................................#..................#........#
............................................................................................................................................
#..........................#...............................................#.......#......#.................................................
............................................................................................................................................
.......#......................................................#............................................................#........#.......
.............................................#.........#............................................#.....#.................................
...............................#.......#....................................................................................................
.................................................................#..........................#..................#............................
..............#.....#.........................................................#......#.....................................................#
.................................................#.......#.............#....................................................................
..............................................................#............................................#................................
.#.......................#...............#.................................#.........................................................#......
....................................#.....................................................#..............................#..................
.....#...........#..............................................................................#.....#.....................................
.................................................................#.................#........................................................
............................................................................................................................................
.................................................#........................................................#.................................
........#.........................................................................................#...........................#..........#..
...............#........#...........#.....#........................#..............................................#................#........
........................................................................................#...................................................
...................................................................................#.........................#..............................
...#..............#....................................................#............................#.......................................
..............................#............................#................................................................................
........................................#.............................................................................................#.....
..............................................#..................#.............#........................#.................#.................
...................................................#.............................................................#..........................
.........#..................................................................................................................................
.......................#.....................................#.......#.....#..............................................................#.
................................................................................................#.....................#.....................
....#...........................#......................#.............................#.......................................#..............
...........................................................................................................#................................
...........#.......#........#..............................#.....................................................#..........................
............................................#...............................................#...............................................
....................................................................#..............#..................#..............#...............#......
.....................................#........................#.............................................................................
...............................................#............................................................#.................#............#
............................................................................................................................................
....#.......#...........................................................................................................#.........#.........
...................................#................#...........#..............................#............................................
............................................................................................................................................
.......................................................................#...........#......#..........#.......#..............................
..............................................................................#......................................................#......
...........................#.....................#..................................................................#.......................
..#............#............................#................................................#..............................................
...........................................................................................................................................#
........................................#...............#............#..........#......................................#....................
............#................................................#..............................................................................
.......#............................#...............#....................................#............#..........................#..........
......................#....................................................#................................................................
...............................................................................................#.............#.....#........................
..................#....................................#.........#...............#..........................................................
.............#...............#................#........................................#.................................................#..
...................................#....................................................................#...................#...............
.........................................#..........#.................#.....................................................................
................#............................................................#..............................................................
..........#.....................#........................#.....................................................................#............
....#.................................#.............................................................................................#.......
......................#.....#.......................................................................................#.......................
..............................................#.........................................#...................................................
..........................................................................................................#.................................
...................................................................#.........................................................#..............
.........#....................#.........#.........#...........#....................................#......................................#.
............................................................................................................................................
..#........................................................................#...............#.............................#..................
..............#...........#..........................................................#..........................................#...........
...................#.................................#...............................................#......................................
...............................#......................................................................................................#.....
...........................................#.................#........#.......................#.............................................
.....................................#.....................................................................#......#.......#.................
................#...............................#................................#......#..........#......................................#.
........................#...................................................................................................................
..............................#................................................................................................#............
.........................................................#...................#..........................#...................................
....#.......................................................................................................................................
........................................................................#........................#......................#.............#.....
............#...............#.............#.........#............................#........#................#................................
.....................#...............#..............................................................................#.......................
..................................................................#......................................................................#..
............................................................................................................................................
..............#........................................#.....................#.......#......................................................
........................#..............................................#..............................................#........#............
........................................#........................................#..........................................................
.......#........................#...................#.........#..............................................#..............................
..#................#......................................................................#........................................#........
.................................................................................................#.......................#..................
..............................................#.............................................................................................
.....#........#...........................................................................................#.........#........#..............
.................................................................................#..........#..........................................#....
..........................#...................................#.........#..............#.........................................#..........
............................................................................................................................................
....................................................................#.......#...................#...........................................
......................#.............#.............#.....................................................#...................................
........................................................#........................................................#..........................
..#..........#..........................#....................................................................................#.......#......
"""

func parse(_ input: String) -> [((Int, Int), (Int, Int))] {
    let lines = input.split(separator: "\n")
    var emptyColumns: [Int]
    var emptyRows: RangeSet<Int>
    
    var output: [[String]] = []
    for line in lines {
        output.append(line.map({String($0)}))
    }
    emptyRows = output.indices(where: {!$0.contains("#")})
    emptyColumns = findColumnsWithoutCharacter(in: output)
    
    var alreadyInserted: Int = 0
    for emptyRow in emptyRows.ranges {
        for i in emptyRow {
            output.insert(Array(repeating: ".", count: output[0].count), at: i + alreadyInserted)
            alreadyInserted += 1
        }
    }
    for y in 0..<output.count {
        var alreadyInserted: Int = 0
        for emptyColumn in emptyColumns {
            output[y].insert(".", at: emptyColumn + alreadyInserted)
            alreadyInserted += 1
        }
    }
    
    var galaxyIndices: [(Int, Int)] = []
    
    for y in 0..<output.count {
        if !output[y].contains("#") {
            continue
        }
        galaxyIndices += output[y].indices(of: "#").ranges.map({$0.lowerBound}).map({(y, $0)})
    }
    
    var pairs: [((Int, Int), (Int, Int))] = []
    
    for i in 0..<galaxyIndices.count {
        for j in (i + 1)..<galaxyIndices.count {
            pairs.append((galaxyIndices[i], galaxyIndices[j]))
        }
    }
    return pairs
}

func findColumnsWithoutCharacter(in array: [[String]], character: String = "#") -> [Int] {
    guard !array.isEmpty else { return [] }
    
    var columnsWithoutCharacter = [Int]()
    
    let columnCount = array[0].count
    
    for col in 0..<columnCount {
        var containsCharacter = false
        
        for row in array {
            if row[col] == character {
                containsCharacter = true
                break
            }
        }
        
        if !containsCharacter {
            columnsWithoutCharacter.append(col)
        }
    }
    
    return columnsWithoutCharacter
}

func parseSecond(_ input: String) -> [((Int, Int), (Int, Int))] {
    let lines = input.split(separator: "\n")
    var emptyColumns: [Int]
    var emptyRows: [Int]
    
    var output: [[String]] = []
    for line in lines {
        output.append(line.map({String($0)}))
    }
    emptyRows = output.indices(where: {!$0.contains("#")}).ranges.map({$0.lowerBound})
    emptyColumns = findColumnsWithoutCharacter(in: output)
    
    var galaxyIndices: [(Int, Int)] = []
    
    for y in 0..<output.count {
        if !output[y].contains("#") {
            continue
        }
        let normalIndices = output[y].indices(of: "#").ranges.map({$0.lowerBound})
        let newY = y + (emptyRows.count(where: {$0 < y}) * (1000000 - 1))
        galaxyIndices.append(contentsOf: normalIndices.map({ x in
            (x + (emptyColumns.count(where: {$0 < x}) * (1000000 - 1)), newY)
        }))
    }
    
    var pairs: [((Int, Int), (Int, Int))] = []
    
    for i in 0..<galaxyIndices.count {
        for j in (i + 1)..<galaxyIndices.count {
            pairs.append((galaxyIndices[i], galaxyIndices[j]))
        }
    }
    print(pairs.count)
    return pairs
}

func main(_ isFirst: Bool = true) {
    let parsed = isFirst ? parse(input): parseSecond(input)
    
    var count = 0
    
    for pair in parsed {
        let xDiff = pair.0.0 - pair.1.0
        let yDiff = pair.0.1 - pair.1.1
        count += abs(xDiff)+abs(yDiff)
    }
    print(count)
    return
}

main(false)

