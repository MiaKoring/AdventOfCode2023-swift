//
//  main.swift
//  DayTwelve
//
//  Created by Mia Koring on 01.11.24.
//

import Foundation

let input = """
???#...#.?#??#?#? 1,1,1,8
#?.???????#????#???. 1,1,12
????.#??##??? 1,2,3
??#.#????#???#.??. 2,10,1
??????.?.???##?#?. 6,1,7
?#????????????###?? 1,3,9,1
?.??#?#?#.???? 7,1
.????????..??.#?. 5,2,2
.?.??#???.. 1,1,1
???#?????????#?? 2,1,3,2
??#?#?????. 4,2
?####???.???#? 6,1,2
#?.?#?#?????.?#.?.? 1,5,2,1,1,1
??.##?#?##??.??? 1,7,1
???.###?#?# 1,7
?????##?#..#? 1,3,1,1
??#??#?.???.?#??#? 1,1,1,2,1,2
?#?#?.???.?? 4,1,1
.?#?????#?? 3,1,2
?#??????????.??? 3,7,1
???????##??###???#?? 2,3,5,4
?.???#.??? 1,1,1
???.#?#?????.?#???#? 2,5,1,3,3
?.#?.#????.??## 1,2,1,3
?????????##?#??????? 1,5,9,1
?###????#??##?#... 9,4
????.#?#????..???. 5,1
????#??.##??#?#??.?? 1,2,5,3
..?????#.???.??##? 1,1,2,1,3
?#?????#??##.??# 12,1
?#??#?#.#????? 1,4,2,2
???#?...???????.? 3,2,4
??#??#?#?#?????#?.#. 1,1,12,1
???#??..?###. 5,4
?#.??#?#????????# 2,2,1,7
????.?????. 1,2,1
?.??????#??.???#.?? 1,1,2,1,4,1
???#??????.??????. 6,1,1,1,1,1
?#??#?#??##??? 1,4,5
?..??#??????.??. 1,4,1,1,2
?.??##???..??? 1,3,1,1
?##???.????#?? 3,3
??????.??#????? 1,1,5
?##.????#????.#??. 2,8,1
????#????#??# 1,10
???.?#??????#???.? 1,2,1,1,1,2
.?###.##??? 4,2
??.????#???#???###.? 1,15,1
?#????#?#???. 3,1,1,4
???????.????#???? 6,4
..??..???# 2,1
.?.?#?????..????..? 1,4,1,1,2,1
?#?.?.???????? 3,1,1,5
?###?.??#??.?###?# 4,3,6
..?#?.??#??##? 3,2,2
.?????#?????#?##?? 1,3,2,5
?#???#??.?.#?????? 8,2,3
??.??????#?#???? 1,2,5,1
?.??????#? 1,3,1
?...#??.?????#? 1,3,6
?.??.?..?#???? 1,1,1,4
.#??????.? 1,1
?????..?#????#.? 1,2,2,4,1
#.###?#????. 1,5,1,1
.???????#.???#?. 1,1,3,1,1
?#?#?.???????. 4,2
#????????#? 8,1
#?.?#????????? 1,2,6
?#??#????##?.???.? 5,1,3,2,1
????#????#???#?.???? 1,10,1,4
?##??????.???#?..?? 9,1,2,1
?#.??#???.. 1,1,2
.?#?????#.? 3,3,1
??.????.#??? 1,2
#??#??.????#??.?.??? 1,1,1,7,1,1
##????.???. 2,2
??##?.?##? 3,3
?#?..?.??..??.?? 1,1
?#????????? 3,1,2
?##??.???.?.?# 3,1,1,2
?.####???????? 1,4,1,1
?..#.???#????? 1,7
?.??.??##???? 1,1,4,1
.#?#?????#?.#??# 1,1,1,1,4
??.?????#????.??##. 8,4
????????.??.##? 1,1,2,1,3
??##???#???#?#??.? 6,1,3
?..??#???#??. 1,8
????????#????#??#??. 2,11,1
?.???????????#?#. 1,3,1,1,4
?#?#.??#.???#???##?? 1,1,2,11
??#?#???#?#??????? 11,1
.#.??#?????#? 1,6,1
..?????????#?. 3,2
????.??.#.?#?#?????. 1,2,1,1,4,2
#??????????##?.??? 5,1,1,3,1,1
????????..???? 3,2,3
??.????#??#???# 1,7,1
..??#.?????????? 1,5
?#?#???#??#??##?#??? 1,3,1,2,8
?????#.?#???.???# 2,1,4,1,1
?.?#??.??.????#??#? 1,8
??#??.?????? 3,3
?#?..??.?#? 2,1,3
.????##???. 1,6
???...?.????##?? 2,7
???..?###?#? 3,6
??.?#?#??###?????#? 1,4,8,1
.????#??#?# 1,6,1
?????.??.? 1,2
?#???##??.?..### 1,5,1,3
.???#???#??. 4,3
???#?.?#????. 1,5
?????..??.#?#?###??# 1,2,1,10
????#??????.?#?..#?? 5,2,1,3,2
#????#???????#???#.? 6,10,1
????#??????.?.?..?. 9,1
.??????##????.???#.? 2,8,2,1
.??##?.???#?# 1,3,1,3
????##??##??#?#. 1,11,1
???#?##.?.??? 4,1
?????#?#??? 1,6
?...????????.? 1,2
#??????##??..??? 2,1,4,1
.????????#??. 3,1,1
??#??????##..?.????? 3,6,3
??###??.??###?. 6,5
???.???#???.#?.?? 1,6,1,1
?????#??????? 1,6
.#??#?#?#??.??? 2,7,1,1
#??..??????#? 1,1,1,5
?#..?##??#?. 1,7
?#?#?#??..?.?. 7,1,1
.????????????.?##??? 1,1,8,6
??????####?..# 2,6,1
?????#???#???????? 10,1,1
??#??#???.??#??? 3,1,2,1,3
.#..?.?.?###??#...# 1,1,1,6,1
?#?#???.#??#????..? 1,3,4,1,1
.?##???#????#???? 3,2,4,1
###?..#??#??? 4,1,1,1
???.??#??#??. 1,7
????#?##??? 1,1,5
?.????????????##? 1,1,3,1,4
??#????#??. 1,4,1
.??#???#?.???#???#?? 8,6
##???#??.???#?.?? 6,1,1,1,2
#?#??#???#? 3,2,3
??#??????#??#?? 2,6,1
?.????#?#..??????.?? 6,2
.??.??.#?#?##? 1,1,1,4
????...?????????? 3,5
??#####.###???.?? 7,3,2
?##.??#??#???#??? 2,11
??????.??.?.???? 3,1,1,1,1
?.##?????##?? 2,4
?.???#?????.??????? 1,5,1,1,1,1
?????????#??? 2,9
?#???#?.#?.???.# 2,1,2,1,1
?#??????#?#? 1,1,1,3
?#??????#??.#????? 9,1,1,1,1
#???.?.?#????#???# 4,1,2,5,1
??#??????? 1,6
?????.?#?? 1,1,2
?????##.?.?# 1,3,1,1
???#?????#??# 1,2,2,4
.?#??????..?# 4,1,1
.#???.?.??##.???? 3,1,4,4
???.???#.????.#????? 3,5
#??#??#... 4,1
??.??#??#..???.?? 5,1
??.?#?????..##????? 1,6,2,1,1
..?#??#???????#?#? 8,5
?.??#??.?.??????. 3,6
.#??###???????##??. 1,6,5
??????#???#? 1,3,1,1
??#.?##?.?? 1,1,4
.??#???.?#????.?. 6,2,1,1
.??????#??#?? 6,2
#.?#??##?.??? 1,6,1
.?.##?????. 1,2,1
.?#?.????# 2,5
.????#?.#? 1,2,1
?.???.####???#.?. 1,8
?.#?????.??.???#?? 1,1,1,1,1,6
??#.?#???##??#. 3,9
??.#???????.???#???? 1,1,1,1,2,4
??.???????##? 2,2,3,2
.?.??#..??.. 1,1,1,2
????#?.???###?#???# 4,1,6,1,1
????#??????...???? 4,3,1
#?.#?.?????#??? 2,1,1,4
.????????#???#??.?#? 2,2,8,1
?????.##?? 2,3
##??.##???? 2,4
?????#??#?#?.#??.?? 10,3,2
?????..??????#?. 4,3,4
..?#.?#?#???. 1,5
..?.?##??? 1,2,2
#??#???##?? 1,3,3
??.#?????.????. 1,2
?##?????#?? 6,1,1
????#??###? 3,4
??????#???????#? 6,5,2
?#.??.?#?.#????#.? 1,1,2,1,4
?????#?#?###???##?? 1,5,3,6
#???#?#?#??????.?? 10,2
?.??#???.#.?#?.?#?? 1,5,1,2,3
?#??##?#.????.. 7,3
??#..??.?#?? 3,2,1
???#??.???.?? 5,1,1,1
??.??#.?#.??.??? 1,2,2,1,1
??.#???#?. 1,2,1
??.??##???. 1,5
?##?#????#??.???.# 3,1,5,1,1
??###?###?#????.???? 1,13,1,1
.???.??##.? 1,4
??????.??###??????? 2,5,5
.#?#?#???#?? 1,7
????#?#..#??.? 3,1,1,1
??#?.##?##?###???? 1,11
.?.#??????##???? 1,1,1,4,1
#??.##??#???#?#???#? 1,15
?????#???#?#?.? 1,8
?#???##??..?## 7,3
????????#? 1,4
##????#???????? 2,4,1,2
?#?##.?###??..?.? 4,4,1
??##???##?.??? 8,2
.???????#.?##??### 7,8
#????????????.##?? 6,1,2,3
?.??????#?????..#? 1,2,1,1,1,2
????#??..?.#???#???? 6,1,1,2,2
.??????#?.?#??.? 3,2,2
?????.??##? 3,1,4
.?.???##.##?### 5,6
?##?????##???#?.?.#? 3,1,8,1,2
????.?##.?? 3,2
?.??.??.??#?###??? 1,1,1,1,6
?.??????#?# 2,3
??#?#?.?????# 6,1,1,1
?.#?#??#?? 1,2,2
??????.#???# 2,1,3
?.#..???#. 1,1,1
#???.????? 4,1
??#?????##???.??? 10,2
??.??#.??? 1,1,1
??..???????#??? 1,1,1,1,2
#??.????#?? 1,2,1
.#?.#???.?.? 1,1,1,1
??????.##?#?. 3,5
?##???????.?##??#?? 3,2,1,8
??#?????.?#?#. 4,4
.???????#??#???.?# 12,1
.#??????.??#?.? 3,2,2,1
?????#????.??#???.?? 10,5
??.#..??#? 1,1,2
?????#?.??#? 2,2,2
?.#???.#????..??#? 1,1,1,2,2,2
?##??..#.#?.?#. 4,1,1,1
?????#.??.#??? 1,1,1,3
??????#??.???##??.?. 8,5
?#????#??????.??? 3,2,2,1
#??????????##..??.?? 1,1,1,5,1,1
##??#????????..?.?.? 13,1
.????.#??#??.?#??# 1,1,1,3,2,1
.?##??#????...?????. 10,5
##.???????????.#??? 2,1,6,1,2,1
.??#??#?.?#???? 3,1,4
.???.??????## 1,2,3
????????#??#?#?. 5,7
???.??#??#?. 2,2,1
..??????##. 3,2
??????#????????? 1,5,1
##?#???###?#?.. 10,2
???..???##?.?#..?? 2,1,3,1,2
?????##??? 1,5
?.????#?.??#? 1,5,4
..????#??.?.#?? 1,4,1
#????#?.?.. 6,1
.?.#??.?#???#???? 2,5
.?#..??.????? 2,2,2,2
???.??#????.?.??#??# 1,4,1,6
.#???????..#????? 5,5
##???.??#?? 2,1,5
?##?????#??? 5,1,3
??.#.#?????#??? 1,1,1,1,3
??.??.?#?? 1,1,4
?????.?#?? 1,3
????#?#????? 1,8
????????#?### 5,5
.??.?.??#?? 1,1,1
????????#???#?. 3,3,2,2
??.#???..?.?.?. 3,1
???????#.?????? 5,5
.???#?.????. 4,1,1
.??#??#??.?# 4,1,1
.????..?.?? 3,1,2
#??#?#?#####.?? 2,1,7,1
.?#??#???.? 2,1,2
#???#?#??#??.? 1,2,1,3
?#?#.???#? 1,1,4
??.????#?..??.?.?#? 1,1,4,2,1,2
#??????#??.???##??. 2,7,1,5
?#???.#.?????#?#? 4,1,6
###???.??..###?#?.? 5,2,6
??#?#??##?????# 1,1,5,4
.##??######???#?? 3,7,2,1
?#.?????.#?#?#???? 1,4,7
??.?#???##?????#. 1,3,6,1
??????#???????#??. 1,2,1,2,3
.???.?#?????.?.? 1,3,1,1,1
?.##??????? 1,3,2
..????.??? 1,1
..??#?.??? 4,1,1
?##???#.#? 3,2,2
???#?????.#???? 2,1,1,3,1
.??.?????..# 2,1,1,1
.????????#??? 1,3
??.???#??????? 2,4,3
?..?#?????.?##.# 7,3,1
??.?#?#????? 1,9
?#..???#?#??#.? 1,6
?#?#?????.#??. 8,2
??????????. 1,4
.?#????#?.#?## 2,1,1,4
#?#?###????.???????. 11,1,1
.#??####.?#??? 7,4
.???.#???#?###?? 2,1,1,4
#??????#?? 2,1,3
?.?.##?#?.?..#? 1,2,1,1,1
???#?#???. 4,4
?.???.??#??? 1,1,3,1
???????..## 2,1,2
?.???????.?? 1,1,5,1
#???????.?#?#??##?? 3,1,1,6
?.??.?.???. 2,2
#??##???#??.??. 5,2,1
????????#? 3,1,1
.?????#??##?.#?##??. 8,5
..??..????#?? 1,5
?????#.?#???##??? 1,1,2,8
???#....?# 1,2
?.??????#??#?????? 1,1,7,2,1
?##?.#??.. 2,2
?.?.?..??#?#??? 1,1,1,4,1
.##?.#.#??#??. 2,1,1,2
.????????#?? 2,2,3
?..#????.????#?#?#. 1,1,3,3,3,1
?.#?.?????#???????# 2,12
????##?#????#?#. 12,1
?.?#???????.? 1,2,1,1
##?.????.? 3,2,1
.??#?#???#.??.???? 6,1,2
.???????###?.????. 1,1,5,1,2
..#?????????????? 8,1,1,1
??.#??#?.?# 2,1,1
???????????#????? 2,6
?#.??.???. 1,3
?#???.?.??.??????? 1,1,1,2,6
??????#?????.?? 5,1,2,1
.#???.?.???#? 2,1,3
??##.??.???.??? 3,1,1,2
???.????#??#??##??? 3,1,11
????..##?..?? 3,2
??????????? 1,1,5
???.?#.?.?#?#??????# 3,1,1,8
.??.??#??? 2,6
##?..??????? 3,5
??????#????#.?#???# 1,1,3,1,3,1
?#?????.#?. 3,1,1
?????.??#??##??? 1,1,7,1
.????#??#? 1,4,1
#???#??#????.??? 2,9,2
?#????#??.???.?.? 1,6,1,1,1
????????.#? 2,1,1
???#??##.??#??#?. 7,4
#??.????.??????#? 3,1,1,2,2
?##?#??..?#. 3,1,1,2
.?.?????##???#.?. 3,6
#.?????### 1,2,3
????.??.?# 2,2,1
?????.????.#???#?.? 1,2,2,6,1
????????#?#.????? 4,2,1,1,2
?##????.#? 3,1,2
????.??????? 3,1,1,1
???????#?.? 4,4
.#.??????????. 1,3,4
?????#?.?#.? 2,3,2,1
?#.?????##??.???#? 1,7,1,1,2
#?????.????#?? 1,2,4
???????.????#?? 5,1,2
??.??.##?????.??#?? 1,6,5
???.?????..?##???? 2,6
???????###??##?#? 1,1,12
????????.? 1,1,1
??..???????#? 2,7
??#???.#??##?????? 4,1,5,1,1
.?.???????????#?? 2,5
?????##?.? 1,3
?????.#.??#??#?##?# 3,1,3,6
???.????#? 3,1,1
.??.???.#??.#?##???. 2,3,1,7
..?????###?#???????. 11,2
????????.???????#??# 1,5,3,2,1
??????.##?##?.? 2,5
??.??#???#???.?.? 3,5
?#?#.??#????#.??# 3,2,1,1,1
????#??.##?????.#?. 6,4,1,1
?.?.??.???? 1,2,2
#.?????????#? 1,8
.?????????#??????? 1,3,3,4
???.??????.#.??? 1,1,1,1,3
???.?#?#??? 3,4
????????.???##.??? 1,1,1,1,3,1
??.?.#.?.????.?.? 1,1
???###?##???# 1,6,3
?.?.????##??. 1,1,4
?.????.??.###???? 1,1,1,4,1
?#??????.?????#???. 1,1,8
??????#?.? 1,3
####??#?..#?????# 7,1,2
.????#??.#.???? 1,1,1,2,1
??..#??.?#?##? 3,6
?.??.??##???#????#? 5,7
??????#??.?.??? 3,2,2
?.???..?????#??.. 1,1,8
..?????##?? 2,3
??????.?????#??? 1,1,1,8
????#...?#.?? 1,3,2
??#??.??#??#?? 2,8
#???????..? 1,1,3
?#.??#.?#??# 1,3,5
#???????????###??#?# 2,1,1,1,9
.??##?.?????? 4,5
.????.??.?#. 1,2
#??????????#?..? 2,4,3,1
#?.???###?##????.?? 2,10
??#?..??????. 1,3
#??#?????#?? 1,3,5
??..?#..??.?? 1,2,2,1
?.??.????.# 1,4,1
#????.???? 2,1,2
.????#??#?????#.? 7,2
?.?.??????? 1,3,1
#?#?###??##?#???.#?? 11,2,2
#?..?????#???? 2,2,3
?.??????.????.?# 1,3,1,1,1
??????#?????.? 1,1,3,1
???#????.?#????. 4,1
##?####?#?#?.???? 11,2
??.#?.?.?#?.? 1,1
????#????###?#????? 2,1,11,1
#??#?.?#????#?#????# 4,2,1,5,1
??.???#.??#.#?#?#??# 1,2,1,1,1,8
?#?????????.?? 1,5,1,2
???#????#???#..? 4,1,2,1,1
???..??##?# 1,5
??.?.#?#??#???#?# 1,1,4,3,3
?#??#?##?#???? 5,4,1
????##??#? 4,1
#?.?????.#?.? 2,3,1,1
??.?#????????? 2,4,1,2
??.?.???.?????#? 1,1,2,2
??.????.??? 3,3
??.??????##???? 1,3
?#????.??##? 2,1,3
??#?##??#?#? 1,4,1,1
.?.#???.#.???#??#?? 1,1,1,1,8
???#.??..#??????.?? 3,1,5,1,1
?##??.#?.??.?? 2,2,2
???#?.???.?##?? 4,1,1,2
.?????????#. 3,1,3
???###?.#.#?#?.#? 6,1,4,1
????#???#?? 2,7
??#??#????#?? 7,3
..?.?????? 1,2,1
?#?#??#??. 1,4,1
??##????.? 5,1,1
.???#?##?#??? 1,1,2,4
??#???.?##??. 4,4
??##?#?#???.#?????. 4,1,4,3,1
.????##?????#?? 1,1,2,6
?.##????.#?#?.#?? 1,4,3,1
?????#?#?? 1,6
.#?##??????.?##.??. 6,1,3,1
??#?.?????.?#??.? 3,1,3
.?????###?? 2,4,1
?.?#?#.??...#..?? 1,4,1,1,1
??.????.??????#? 2,4,1,3
.????.?##?#?? 2,3,2
#?#?####?#???.#????? 12,5
??#.?????? 2,3,1
.#???#??#???#?#?..?? 1,1,1,7,1
??#????#???.#? 7,2,1
#?#?#..#???#??? 5,1,2,1
.?#?#####??.? 8,1
???#?#?.??#???.?# 6,3,2
.??#???#??? 1,2,3
???#???#??#? 2,3,1
?????.??????.?.?? 2,3,1,1
.?##????.????? 5,3
##?.#??#?. 3,2,2
???.#?##?#?#??.#?? 2,1,6,1,1
??#????.??????#?#?? 6,5,1
??#?#?...???# 4,1,1
??.?#??.?##.?.#??? 3,3,4
#?#????.??????#?? 7,1,4
.??????#??? 2,5
#?#?..????????????? 4,6,2,1
..#?#????#?? 3,4
#??#?#??????#??#?#? 10,7
?????.?#?#??? 1,6
??###???.???#?.## 6,2,1,2
????#??#?##. 3,1,4
#????#??#?????#?.?? 1,8,2,1,2
#.???#?????.? 1,4,1,1
#?.??.?????#?##.? 1,1,4,4,1
.??.???????? 1,1,1,1
??.?##?????.. 1,6
??#???.???? 1,1,1
.?.?.??##?????#?? 1,1,10,1
?????????????? 9,1
??#.#.??#???? 1,1,5,1
.???????#?#????.?.#? 5,4,2,2
.#??#??#?.? 1,5
?##?#??##??#??#?.??? 15,1
?#?#????????#?.?.# 3,3,2,1,1,1
???#??.?????#??.. 3,6
???#??..???#?.?.??? 1,2
##???#.?.. 3,1,1
??.??#?#?#???##?#?.? 2,1,1,1,9
.#????#?#????#?#?. 9,4
???#?###.##. 1,1,3,2
????#.?..???#?? 1,3
.#.????#???.#??? 1,6,1,1,1
??#.?.?#???.#?..#?. 2,1,2,1,1,2
?#????..?? 2,1
????.?#???#.???? 3,5,3
??????????##.???#.#? 1,3,1,2,4,1
?.?#.????#???##.? 1,8
#?.#????.? 1,3
.#???#.?#?????.?? 1,3,5,1
?.#????##?? 1,3,3
##?.?.#.??????#?? 3,1,1,4,1
????.??.?.????? 1,1,1,1,2
.?#?##.??#???? 4,6
?.?????.?#.. 2,1,1
????.?#??# 1,1,1
#.####??#?.#??# 1,8,1,1
.??.##???? 1,2,1
??..???.#. 2,1,1
?..????.??? 1,2
.??????#...?.????? 1,1
???.??#???##?? 1,3,4
????#??#?#??????##?? 1,5,1,1,5
?#???..???#???#??? 2,6
??????.??##?. 2,3
??#?????##??#.#?#??# 3,7,6
???.?????##?? 1,7
.?#??#?.?.?? 1,1,1,1
??.????#?? 1,2,1
???###.#???? 4,2,1
?.?#????.???????.. 3,1,6
???.??.#?#..??##. 1,1,1,1,4
????#????#.?##? 2,1,2,3
??#?##?#??.??????? 8,3
..#???#????.??? 1,3,1,2
??#?.?.???????.#.?? 3,1,1,5,1,1
?????#??.?? 1,2,1
????????..?#??#??.## 1,1,2,6,2
.#??????##??.?.??.?? 9,1,1,1
??##??#?????. 8,2
#.?.?????? 1,2
.????#?#???#..??# 2,7,3
?.?#?????????.#? 1,1,1,3,1
..#????.?????? 3,1,1,2
??#??#?.????.???.? 3,2,1,1,2
#???#.??.##??# 3,1,5
?.?.?#?##.???? 1,1,4,2
.?###..??#??????## 4,1,4
???#??????#. 2,4
??####????#?.??.. 7,1,1
#?.??????#? 1,2,1
.?##?#????????#?.??? 3,1,1,1,5,3
?.???#?##?.. 2,4
????#???..?##?# 1,1,1,3,1
??#??.#?.?????.? 4,1,4,1
???#.???.??. 4,1,2
?#?#...??#. 2,1,3
????#.?#..??. 1,2,2,2
?.#??#????#?##??? 12,1
??#??????#? 6,3
???.????#??? 1,1,1,2
???#.????.????? 1,2,5
??.?.??#??.??#??? 1,1,5,1,3
??#??????? 2,2
?.??#???????##??? 1,6,3
???#?#?.???#????#?? 7,1,8
.????????????? 3,1,2,1
?????##?#?#??.... 1,8,1
.?##???????#.???. 3,2
???.???????? 1,1,1,1
???#.?????????#?#..? 1,1,1,9,1
?##???#????.??#?#? 10,4
#??.????????? 3,2,1,1
?#?..???#?#?? 3,1,6
?##?#.?##?. 4,4
?#.#?..?#???? 1,2,3,1
??.##??#??#?#? 2,5,4
????##?#???.#.??... 8,1,1
##???????..?.?#??.? 2,4,2
?.?#.?#???. 1,4
.?#.??.????? 1,1,1,1
??????.???.?#?##??.? 2,4
???.????.??#??.?? 1,1,2,4,2
###?#??#.???????? 8,3
???..??#.????. 2,1,1
???.?##???.??????# 2,6,4
.?#?##.?#?????.?? 5,4,1
.??..??.?#? 2,2
.?#??????.##?#? 4,2,2,2
???##.?.?.#???. 2,1,1
?????#???#? 7,1
.#?.???#?.??# 1,3,1,1
?.#?..?#??#####?# 2,10
??#?##???#?#???#?#? 1,8,1,1,1,1
??????#.??#?###. 2,1,6
?#?#?#???#??##???# 1,3,9,1
?#???.????#.??#?#?? 1,1,2,2,3,3
?#?#.#.??.?#??????? 3,1,2,3,1,2
.?#?...?????#.??? 3,4,1,2
?????????#?#?.?# 1,1,1,5,1
##?#?#.???????#?? 6,4
?#??#?????????# 3,1,4,2
???#???#????.?? 1,6,1,1,1
?#.????##?.? 2,6
?.???##??.?#??#? 3,4
??#?????#.?#?. 2,1,1,3
?.?????#?#??#.?.#??? 11,2,1
????#???#?? 1,3,1
???.?#.???.???. 1,1,2,1,1
??????#?..??#? 5,2
.?.?#.?#??. 1,4
?#.??????##????.???? 2,7,1,1,1
?#?#?.?????. 3,1,1
???.##.?.#?. 3,2,1,2
..????????#.####??? 6,5
??#.??..?##?##????#? 1,1,9,1
?#???.??##?.??????. 5,4,3
.?...??#?????#.# 1,7,1,1
??????.?#??.?.? 5,2,1
???..??##?????? 2,5,1
???##?#??????.#.??. 7,2,1,1,1
?????????#?? 1,2,1,1
??.##??.?### 1,2,1,4
??####?#?###..?????? 1,10,1,1,1
??.??#???#??? 1,2,4
????..???#???. 1,6
??????????#? 8,1
#?#.?..????? 1,1,1,2
.?????##???#??? 12,1
##??#?..?#..? 2,2,1,1
###???????. 5,1,1
??.?.##?##??#?.?# 1,1,8,2
???####?.????#?#???# 1,5,10
??.??#???.?????#?#?? 1,1,4,6
???.#??#??..??.?# 2,4,1,2
.?.??##?###.???##? 8,2
.#??.?#.??#?? 3,1,3
????#????#??#??#??? 5,8
#..#???.???#???. 1,1,1,1,3
?.##?????.?#?????. 6,4,1
.????????.??#?? 2,1,1,1,1
.?.????????##?.?.?#? 1,1,5,3
??.#???????## 1,1,1,2
??????#??#???#??#??? 3,1,9,1
??.#??.???#?. 3,4
????.???##. 3,5
#??.??#????? 2,2,1
#?????#??.# 1,6,1
????.??#????.??. 1,7,1
##???????????. 6,1
.??#?????.????#???? 5,1,1,3,1
?????#??#??.?? 1,8
???#..??.???.. 1,2
???#?.#..????#?# 2,1,1,1,1
????.?.??#??#?? 2,1,7
.???#?##????#?? 2,1,4,1
??#?????#?? 4,1
.#????#?###?. 2,7
..????#??? 3,1,1
####???#..??. 6,1
?#???#???##????#?#?. 2,1,10
??#?#?#?.?????# 1,6,1,1,1
?????.##?#?#?#?.??#? 1,2,9,1
.?.????.?. 1,1,1
?????????? 1,3,1
#????#?????? 1,3,3
#.?#..???? 1,1,1
?#?????..????#.?? 1,2,4,1
#?##??????.??. 1,2,3,2
???#??#??. 5,1
?##???.?.??#.?# 3,1,1,1,2
?#?????????? 2,7
??#?#???#?#?????? 2,5,1,1,1
..#?..?.##?.? 2,2,1
???????.???.#?##.?.? 1,4,3,4,1,1
??##??###.# 7,1
?###?#??.#.??..?? 4,3,1,1,2
??????#??#?. 2,2,2
?#?##??????..#?? 6,2,3
?#?#???????..#.#?? 9,1,1,1,1
#?#?#?#????.?? 1,5,2,1
?????#??.?#? 5,1,1
??##???.?#??#.??.? 5,5,1,1
.?#?.?##?? 3,2
.???????#??..?#?? 8,1
?????.???# 4,1
?#?....???..??#? 3,2,1,1
???####?????.???#??? 1,5,1,1,1,1
???.??????...#??? 1,5,3
????#??.???????? 1,1,1,1,3
?#.???.#### 1,3,4
?.?#???#?#?#???.? 1,10,1
???.??#.?.? 2,1
??.??.??????.??.?? 1,1,3,1,1,1
.#??.?#????.#?###? 3,4,1,1,3
#?.???#?.?. 1,2,1
???#???.?? 4,2
????.#?#?#.?#####?# 3,1,3,6,1
..??????##?#?????#?? 2,1,5,2,4
#??.??#????#???#???? 1,15
???????????.? 1,5,1
?#??#???#?? 5,3
.???##????.?????.#. 1,4,1,1,1,1
?.?#?#??.?#?????? 6,2,2
.????????????? 7,1
...?.#???????#? 1,1,2,1
?????.?#?? 2,1
?#.??????? 2,2
#????#???##? 1,6,2
.?#?.?.???#?# 3,1,4
?#??#.??.?#?? 1,1,3
????#.?????#?##.?? 5,1,6,2
???..???????.##?? 2,6,2
..?#???.#?? 2,2
???##?.??#????????. 4,2,2
????#?????.?#??#. 1,5,2,1,2
##.??..#?..?#???? 2,2,1,3,1
??????#???#?#??? 5,7
.?#??.#??#???.#.#? 4,1,1,1,1,1
?.?????#?#?.?? 1,5
?????????#?????#?# 10,2,1,1
??????#??##????#??? 1,5,2,2,2,1
.??#?#????.??### 1,1,1,1,4
?????#?????#????? 4,2,2,1
??.?.?#??????#.??? 1,2,3,1,1
.??.?.???? 2,1,1
.??#????????? 1,2,3
???#?????#??#????#? 1,1,1,5,1,2
?????##???#?? 3,4,1
##?????????# 5,1,1,1
???#??#??????.? 4,1,2
????.??#?#?? 1,1,4
#??????.#???. 1,4,4
????##.??#???#?.??? 3,5
????.?#??#.##???? 1,1,4,2,3
#?#???#??????#. 1,6,2,1
???.???##?#? 1,1,4
?????#.???? 5,3
?#??.????#?????# 1,1,5,3
????#?.?#?.?.?. 1,1,2,1,1
???.???#?#?#??? 1,9
.?##??.??#???#???#? 3,3,6
?????##??.?? 1,6
#????????#####.? 2,1,7,1
#?..??.??#?? 2,1,1,3
?##?#???#???.#??? 5,3,1,1
.?????????????????. 1,1,2,1,1,4
?.???#??.?#?????? 4,5,1
?.????#??#?? 1,1,1,1
??????.#???# 3,1,3,1
#?#??..???##?#?.? 4,6
#??#?.????.?.? 5,1,1
?.?????.??#?#?##??? 1,1,1,10
???#?#.???##???.?.? 1,3,7,1,1
#?#.?#??.??? 3,3,3
.?#???#???.???# 7,3
?#????#??. 3,3
????####?#?.???? 2,5,1,2
?#???#??...??.? 2,2,2
?????????????#?###? 2,11
??.???????###?# 1,4,4,1
????#??.?.???.#???? 6,1,1,1,1,1
??#?#???????? 6,1
#??#?#????#???.? 9,4
?.#?#?#????????#??.? 8,1,3
.?.???#???????????? 1,7,1,2,2
?#???###????.??#?# 1,5,2,5
??#?????.??# 1,2,3,2
?##????.??.?# 4,1,2,1
#.?#?#???? 1,1,5
????.##??.?#??????? 3,4,4,3
?#.??????#??? 1,1,1,3
?#?.#?..??.??? 1,2,1,3
..???????? 3,3
?#????????. 1,3,2
.?#.???#.?? 2,2
?.??????????.?? 3,3,1
?#.??????..?#? 1,4,3
????????.??.#??? 6,2,2,1
?#???????.?????? 2,4,5
???.?#???. 1,1,2
??????#.?##??????#?# 1,5,3,6
??#?????#??.???#??. 4,2,1,5
.?#??.?.?. 2,1
#??#?.#?.#??.???? 5,1,1,1,1
???#????.#.? 2,1
??????#???.#.?#??##? 3,1,5
????#???????.# 9,1,1
????????#?##?#..#?. 1,2,3,2,1,2
??.?##?##.??????#? 2,2,2,4,2
###??#???#??? 3,1,3,1
.?.?.?#?.???#?# 1,1,3,1,1
.?..?#?????.???#??#? 1,2,1,1,2,3
?#.?????????#??#?#?? 2,1,14
?##.#???#?????? 2,1,1,1,1
???#.##???.? 3,5
???????.???#?? 4,1,2
??.#?????#??? 1,10
?#???##???? 2,4,1
?????.????? 3,3
??#?#?#??#????#?#? 2,1,2,1,1,3
#?????????#???????#? 1,3,11
..???#???????.? 2,6
??#???.?#??.? 1,2
..?#.?##?#??.. 2,2,1,1
??.????.?? 1,3,1
?????#?????#.# 1,5,1,1
..?#????#? 2,1
???#????#???.? 1,6,1
?.??#.???#. 2,1,1
..???.??#??. 3,4
???#??##?.???? 5,3,1
.??##?#?.???#?#? 5,7
#.?.???#???? 1,5,1
?????#??.??? 1,3,1
????????####??.##? 3,7,3
???????##???? 1,8,1
???..###??#??#???# 2,3,8
??##????#? 5,1
#??#?#?#?#.#?##.. 10,1,2
##?#?#?????#??? 7,1,2,1
??????????#?##????.? 2,11
##????????.#.?#?# 2,6,1,4
?#?#????#.?### 1,6,3
#?#?#?#..??? 1,1,3,1
???.#?#### 1,6
????????#?.???# 2,4,3
#?????###????.??#?? 12,3
??#.#???#?????.#? 1,5,1,1,1
??#?.???#?????#???? 3,1,5,1,1,1
????#?.????.???? 2,2,2
???#??????????.? 4,7
?.??###???###?#???#? 11,1,1
???????..?? 1,3,2
???#?#?#??#???# 9,1,1
????.????#? 2,4
??#???.?.?.??.?##? 2,1,1,1,1,4
?#.#..???#? 1,1,5
??????????????#???#? 2,3,8
????#?..#?.?##?#? 1,1,1,6
?#.##???..??#?#????# 1,2,2,1,5,2
????#?##?#.? 8,1
..#?#????#? 3,1
???.????.?????## 1,1,1,1,6
#??.????????##??? 1,1,4,4,1
#??#??????. 4,1
??????.???#?????.. 1,1,7
?#.?.????????##??? 1,1,2,2,2,1
????.?##????? 1,1,8
?###?.?#.?##?.# 3,1,2,1
????????.??? 2,3,1
?#?#...##?? 4,2
??#?.#??#.. 1,1,1
#?#.?????.??.. 3,1,2,1
?..?#??.?#? 2,2
#??????#??#?.#???### 4,5,3,3
#??#???????????? 1,2,6,2
?#?????..#?? 4,1,1,1
?.#???#??? 2,2
?#..?.??##???#.?? 1,5,1
???.?.?...?##? 2,1,4
#???.#???#??## 1,1,3,5
.????.?..????.#?? 1,1
??#??.????##?.?.? 1,1,1,4,1
#???.????? 1,1,4
????#.#???.#?? 4,4,2
?#??.#??.##?????..# 1,1,3,2,3,1
???????##???.???.? 2,6,1,1
?.???#?.?.???#???? 4,2
?.??.????. 1,2
#???#???#??????##? 10,2,3
?.??????##???#???? 1,4,10
????#???????.##?##?# 1,2,1,1,7
?????#????#?? 2,5,1
???..?????#??#??.?#. 1,6,3,2
???????#?? 1,3
.??.???.????# 2,3,1,1
????#.#?#####?? 4,8
?#???????????.?. 6,1,1,1
????.?#?##???#????? 2,11
.?.#.??????#??????? 1,1,1,1,7,1
????###.??.. 7,1
???#?.???? 4,1
????.?????#?. 1,6
?##?.????? 3,1,1
?#.?#?#?????.?? 2,7,1
#?#????#?#..????#??# 1,1,5,7
?.##?#????? 4,1
.??#?.###??. 3,4
#??##?????#??#??. 6,6
.#?#?????#?..#? 4,4,1
?.?.??.?#?###? 1,1,1,3
????.?????? 1,4
??????..?.?#?#? 1,1,1,1,4
????##???????#.?.? 5,1,3,1,1
???#??##??##???#???? 12,4
?.??##??#???.?#?. 1,4,2,1,3
???.???#???##???.?. 2,4,5,1,1
?#??..???##???.?? 3,5
?????#????#?.??#.? 1,1,3,3,1
??.????#..??.#?#?#?? 2,7
??##??.????#? 5,2,2
?????????????. 1,1,5
.????.##?# 4,2,1
??.??.?.?? 1,1,1
?#??.???.??.? 2,1,1,2
?.?#?????.?????#? 6,1,1
??##?????#???. 10,1
.?#???????##..#? 1,4,3,1
???#.???.??? 1,1,1,1
?.?#.???..#? 1,2,2,1
?.?#????#??????# 9,2
????#?#?.?##??????? 1,3,2,5,2
?.????##???#??? 1,7,1,1
.?#?.??.##???#??#? 3,2,3,1,1
.#??##????#???#. 6,1,1,2
?????.?.???? 3,1,1
??#??#####??#??.? 2,6,1,1,1
?.?.?#????#?#..? 1,4,4,1
??????..??????#??? 2,5,3
.#?#?#?.??.?#.. 5,2,2
###.??.??????##?# 3,1,9
??.?.####?..? 1,5
????.??.??##. 3,4
#???#??#.???.##??? 1,4,2,4
????.??????. 1,2,2
???#???#??.? 1,3,3,1
????#?#?#?.??? 5,1
#??.??#??????. 1,8
??????#??? 3,2
???##????#?.#?# 1,4,3,1,1
????..????.??#??## 3,1,1,7
???????##???? 2,2,4,1
???.??##?????#.??##. 1,4,1,1,1,2
#.????????????..?? 1,8,1
???..?##???#?? 2,3,3
.?????#..###?. 1,1,4
???.?.???????? 1,1,2,1
????#?#????? 1,1,5
???.?#?#??#?#? 1,2,1,5
.?.???.??#?###??# 1,1,7,2
.???#??.?#??#?? 4,3,2
?#.#??#?..???? 1,1,1,3
#???#????.#??????#. 1,4,1,5,1
..????#??#? 2,1,1
?#...??#??? 1,4
.####?????# 6,1
???#?#??????..#??? 4,3,3
#.???????.????#?? 1,3,1,5
???.???????. 1,7
??#.??#???##??????? 1,10
?????.???.??#??#??# 1,1,1,3,6,1
?.?#???..?# 5,2
??#????##???..?. 3,4,1,1
##?????.###?.? 3,1,4,1
?..#?#??.?????? 1,4,1,1,1
??...#??.??.?. 3,1
.????#?..?#?# 5,3
???#?????????.????.? 11,1,2
.??#???.?#?#????#??. 3,5,3
??#??#.????. 5,2
??????#?.???.?????? 1,2,3,2,1
?##???##?..#??#?? 2,3,4,1
.???#??#????#??????. 7,7
???#?..??# 2,1,1
.?#.???.?????? 2,2,3,1
.#?..#????? 2,2,3
"""


func parse(_ input: String) -> [(Regex<AnyRegexOutput>, String, Int)] {
    let lines = input.split(separator: "\n").map({value in
        let parts = value.split(separator: " ")
        let springs = parts[0]
        let counts = parts[1].split(separator: ",")
        let regex = {
            var regexStr = "\\.*"
            for i in 0..<counts.count {
                if i == counts.count - 1 {
                    regexStr.append("#{\(counts[i])}\\.*")
                } else {
                    regexStr.append("#{\(counts[i])}\\.+")
                }
            }
            return regexStr
        }()
        return (springs, try! Regex(regex), counts.reduce(0, {$0 + Int($1)!}))
    })
    
    return lines.map({($0.1, "\($0.0)", $0.2)})
}

func changedParse(_ input: String) -> [(String, [Int])] {
    return input.split(separator: "\n").map({value in
        let parts = value.split(separator: " ")
        let counts = parts[1].split(separator: ",").map({ number in
            Int("\(number)")!
        })
        
        return ("\(parts[0])", counts)
    })
}

func secondParse(_ input: String) -> [(String, [Int])] {
    let initial = input.split(separator: "\n").map({value in
        let parts = value.split(separator: " ")
        let counts = parts[1].split(separator: ",").map({ number in
            Int("\(number)")!
        })
        
        return ("\(parts[0])", counts)
    })
    
    return initial.map({(pattern, count) in
        let str = Array(repeating: pattern + "?", count: 5).joined().dropLast()
        let count: [Int] = {
            var res: [Int] = []
            for arr in Array(repeating: count, count: 5) {
                res.append(contentsOf: arr)
            }
            return res
        }()
        return ("\(str)", count)
    })
}

extension String {
    func padLeft(with character: Character, toLength length: Int) -> String {
        return String(repeating: character, count: max(0, length - self.count)) + self
    }
}

func generateBinaryPatterns(ofLength length: Int) -> [String] {
    let combinations = 1 << length
    
    var patterns = [String]()
    
    for i in 0..<combinations {
        let binaryString = String(i, radix: 2).padLeft(with: "0", toLength: length)
        
        let pattern = binaryString
            .replacingOccurrences(of: "1", with: "#")
            .replacingOccurrences(of: "0", with: ".")
        
        patterns.append(pattern)
    }
    
    return patterns
}

func generateAllVariationsFor(_ str: String, count: Int) -> [String] {
    let indices = str.ranges(of: "?")
    var results = [String]()
    
    for var pattern in generateBinaryPatterns(ofLength: indices.count) {
        var mutable = str
        for i in 0..<indices.count {
            mutable = mutable.replacingOccurrences(of: "?", with: String(pattern.first!), range: indices[i])
            pattern = "\(pattern.dropFirst())"
        }
        if mutable.count(where: {$0 == "#"}) == count {
            results.append(mutable)
        }
    }
    return results
}

//I was unable to find my own solution, I just translated some python code to swift, now I understand how it works and added some caching to make it even faster, Thanks to u/ai_prof for the base algorithm https://www.reddit.com/r/adventofcode/comments/18ge41g/comment/kd0oj1t/?utm_source=share&utm_medium=web3x&utm_name=web3xcss&utm_term=1&utm_content=share_button

func countLegal(_ s: String, counts: [Int], cache: inout [String: Int]) -> Int  {
    let key = "\(s)|\(counts)"
    if let cached = cache[key] { // if it was already calculated, return result
        return cached
    }
    let str = s.trimmingCharacters(in: CharacterSet(charactersIn: ".")) //ignore leading and trailin '.'
    let strArray = Array(str) // make a part later easier
    if str == "" { //if the pattern is empty and the numbers is empty its correct, if numbers aren't its not
        return counts.isEmpty ? 1: 0
    }
    
    // str, [] is legal so long as str has no '#' (we can convert '?' to '.')
    if counts.isEmpty {
        return str.count(where: { $0 == "#"}) == 0 ? 1: 0
    }
    
    // str starts with '#' so remove the first spring
    if str.first! == "#"{
        if str.count < counts[0] || str.prefix(counts[0]).contains(".") {
            return 0 // impossible - not enough space for the spring
        } else if str.count == counts[0] {
            return counts.count == 1 ? 1: 0 //single spring, right size
        } else if strArray[counts[0]] == "#"{
            return 0 // springs must be separated by '.' (or '?')
        } else {
            return countLegal(strArray[(counts[0] + 1)..<strArray.count].map({String($0)}).joined(), counts: counts[1 ..< counts.count].map({$0}), cache: &cache) // one less spring
        }
    }
    // numlegal springs if we convert the first '?' to '#' + '.'
    let result = countLegal("#" + Array(strArray[1..<strArray.count]), counts: counts, cache: &cache) + countLegal(Array(strArray[1..<strArray.count]).map({String($0)}).joined(), counts: counts, cache: &cache)
    cache[key] = result
    return result
}

func main(_ isFirst: Bool = true) {
    //initial brute force solution
    /*let currentTime = DispatchTime.now()
    let parsed = parse(input)
    
    let group = DispatchGroup()
    let resultQueue = DispatchQueue(label: "result.queue")
    var results: [Int] = []
    
    for z in 0..<10 {
        let toWorkThrough = parsed[z * 100...z * 100 + 99]
        
        group.enter()
        DispatchQueue.global(qos: .userInitiated).async {
            var finalCount = 0
            for (regex, str, count) in toWorkThrough {
                if !str.contains("?") {
                    let res = str.matches(of: regex)
                    if res.count == 1, res[0].range.lowerBound == str.startIndex && res[0].range.upperBound == str.endIndex {
                        finalCount += 1
                    }
                    continue
                }
                let allVariations = generateAllVariationsFor(str, count: count)
                
                for variation in allVariations {
                    let res = variation.matches(of: regex)
                    
                    if res.count == 1, res[0].range.lowerBound == variation.startIndex && res[0].range.upperBound == variation.endIndex {
                        finalCount += 1
                    }
                }
                
            }
            resultQueue.async {
                results.append(finalCount)
                group.leave()
            }
        }
    }
    
    group.notify(queue: resultQueue) {
        print("Analyse abgeschlossen. Ergebnisse:", results.reduce(0, {$0 + $1}))
        print((DispatchTime.now().uptimeNanoseconds - currentTime.uptimeNanoseconds) / 1000000)
    }
     */
    if isFirst {
        let parsed = changedParse(input)
        
        var res = 0
        var cache: [String: Int] = [:]
        for (str, counts) in parsed {
            res += countLegal(str, counts: counts, cache: &cache)
        }
        print(res)
        return
    }
    
    let currentTime = DispatchTime.now()
    
    let group = DispatchGroup()
    let resultQueue = DispatchQueue(label: "result.queue")
    var results: [Int] = []
    
    let parsed = secondParse(input)
    
    for z in 0..<4 {
        let toWorkThrough = parsed[z * 100...z * 100 + 249]
        group.enter()
        DispatchQueue.global(qos: .userInitiated).async {
            var res = 0
            var cache: [String: Int] = [:]
            for (str, counts) in toWorkThrough {
                res += countLegal(str, counts: counts, cache: &cache)
            }
            resultQueue.async {
                results.append(res)
                group.leave()
            }
        }
    }
    group.notify(queue: resultQueue) {
        print("Analyse abgeschlossen. Ergebnisse:", results.reduce(0, {$0 + $1}))
        print((DispatchTime.now().uptimeNanoseconds - currentTime.uptimeNanoseconds) / 1000000)
    }
    //about a second slower
    /*let parsed = secondParse(input)
    var res = 0
    var cache: [String: Int] = [:]
    for (str, counts) in parsed {
        res += countLegal(str, counts: counts, cache: &cache)
    }
    print(res)
    print((DispatchTime.now().uptimeNanoseconds - currentTime.uptimeNanoseconds) / 1000000)
     */
}

struct Key: Hashable {
    let pos: Int
    let index: Int
}



main(false)
dispatchMain()
